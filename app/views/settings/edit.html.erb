<%= render "shared/notice" %>
<% content_for :title, "Settings" %>

<% current_theme = @color_theme.try(:selected_theme) || "pastel" %>

<div class="p-6">
  <div class="grid grid-cols-1 md:grid-cols-[300px_minmax(0,1fr)] gap-8">

    <!-- LEFT COLUMN -->
    <div class="space-y-4">
      <h2 class="text-2xl font-bold mb-2">Pick a Theme</h2>

      <%= form_with model: @color_theme, url: settings_path, method: :patch, local: true do |f| %>
        <!-- Theme Options -->
        <div class="flex flex-col space-y-4">
          <% %w[light dark pastel custom].each do |theme_name| %>
            <label for="theme_select_<%= theme_name %>" class="cursor-pointer block border p-4 rounded-lg hover:ring-2 hover:ring-primary transition-all duration-200">
              <%= radio_button_tag "theme_select", theme_name, (current_theme == theme_name), id: "theme_select_#{theme_name}", class: "hidden theme-radio", data: { theme_value: theme_name } %>
              <div class="peer-checked:ring-2 ring-primary">
                <div class="text-lg font-bold capitalize"><%= theme_name %></div>
                <div class="h-4 w-full mt-2 rounded-full bg-base-100" data-theme="<%= theme_name %>"></div>
              </div>
            </label>
          <% end %>
        </div>

        <!-- Hidden field for non-custom theme name -->
        <%= hidden_field_tag "color_theme[theme_name]", "", id: "non-custom-theme-name" %>

        <!-- Custom Theme Form -->
        <div id="custom-form" class="mt-6 hidden">
          <h2 class="text-xl font-bold mb-2">Customize Your Theme</h2>

          <div class="space-y-4">
            <div>
              <%= f.label :primary_color, "Primary Color", class: "block font-semibold mb-1" %>
              <%= f.color_field :primary_color, id: "primary-color", class: "w-full h-12 p-2 rounded" %>
            </div>
            <div>
              <%= f.label :secondary_color, "Secondary Color", class: "block font-semibold mb-1" %>
              <%= f.color_field :secondary_color, id: "secondary-color", class: "w-full h-12 p-2 rounded" %>
            </div>
            <div>
              <%= f.label :accent_color, "Accent Color", class: "block font-semibold mb-1" %>
              <%= f.color_field :accent_color, id: "accent-color", class: "w-full h-12 p-2 rounded" %>
            </div>
          </div>

          <div class="mt-6 space-y-2">
          </div>

          <!-- Hidden fields -->
          <%= hidden_field_tag "base-100", @color_theme.base_100_color, id: "base-100-color" %>
          <%= hidden_field_tag "base-200", @color_theme.base_200_color, id: "base-200-color" %>
          <%= hidden_field_tag "base-300", @color_theme.base_300_color, id: "base-300-color" %>
          <%= hidden_field_tag "base-500", @color_theme.base_500_color, id: "base-500-color" %>
          <%= hidden_field_tag "base-content", @color_theme.base_content_color, id: "base-content-color" %>
          <%= f.hidden_field :primary_content_color, id: "primary-content-color" %>
          <%= f.hidden_field :secondary_content_color, id: "secondary-content-color" %>
          <%= f.hidden_field :accent_content_color, id: "accent-content-color" %>
          <%= f.hidden_field :theme_name, id: "selected-theme-name", value: @color_theme.theme_name %>
        </div>

        <!-- Shared Submit and Back Buttons -->
        <div class="flex gap-4 mt-6" id="form-actions">
          <%= f.submit "Apply & Save", class: "btn btn-primary" %>
          <%= link_to "Back", settings_path, class: "btn btn-secondary" %>
        </div>
      <% end %>
    </div>

    <!-- RIGHT COLUMN: Live Preview -->
    <div class="w-full flex justify-center items-start">
      <div id="preview-bg"
           class="w-full max-w-[960px] md:aspect-video md:h-auto h-auto flex flex-col md:flex-row items-center justify-center p-6 gap-4 rounded-xl overflow-hidden shadow-xl"
           style="background: linear-gradient(to right, <%= @color_theme.accent_color %>, <%= @color_theme.primary_color %>);">
        <div class="flex justify-center w-full md:w-1/2 px-6 pb-4">
          <div class="max-w-md w-full text-center md:text-left">
            <p class="text-[#1f2937] text-4xl font-bold mb-2">Welcome to</p>
            <div class="text-[#4A4A4A] text-5xl font-bold leading-none">
              <%= render "shared/logo_text" %>
            </div>
          </div>
        </div>

        <div class="flex justify-start w-full md:w-1/2 px-6">
          <div class="max-w-md w-full">
            <div id="preview-card" class="student-card max-w-md w-full p-8 bg-white rounded-2xl shadow-2xl">
              <h1 id="preview-header" class="text-2xl font-bold pb-4 text-center">Sign In</h1>
              <form action="#" method="post" autocomplete="on">
                <label for="preview-email" class="sr-only">Email</label>
                <input id="preview-email" type="email" placeholder="Enter your email address" class="input input-bordered w-full mb-2 mt-2" disabled>
                <label for="preview-password" class="sr-only">Password</label>
                <input id="preview-password" type="password" placeholder="Enter your password" class="input input-bordered w-full mb-2" disabled>
                <button class="btn btn-primary w-full mt-4" id="preview-primary-btn" type="button">Sign In</button>
              </form>
              <div class="mt-2">
                <button type="button" class="btn btn-accent w-full py-3 font-semibold transition-all duration-300" id="preview-accent-btn">Sign Up</button>
              </div>
              <div class="pt-4 text-center">
                <a href="#" class="text-secondary hover:underline" style="color: <%= @color_theme.primary_color %>;" id="preview-secondary-link">Forgot password?</a>
                <div class="pt-4 text-center">
                  <a href="#" class="text-secondary hover:underline" style="color: <%= @color_theme.secondary_color %>;" id="preview-tertiary-link">Back to home</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<%= javascript_include_tag "controllers/theme_selector_controller" %>
<%= javascript_include_tag "controllers/theme_preview_controller" %>
